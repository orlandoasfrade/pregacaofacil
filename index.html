<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PregaçãoFácil</title>

    <!-- Meta tags para ícones e PWA -->
    <meta name="theme-color" content="#0284c7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="PregaçãoFácil">

    <!-- Ícones -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://storage.googleapis.com/maker-media/images/pf-final-icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://storage.googleapis.com/maker-media/images/pf-final-icon-16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://storage.googleapis.com/maker-media/images/pf-final-icon-180.png">
    
    <!-- Manifesto para PWA -->
    <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiUHJlZ2HDp8Ojby1Gw6FjaWwiLCJzaG9ydF9uYW1lIjoiUHJlZ2HDp8Ojby1Gw6FjaWwiLCJzdGFydF91cmwiOiIuIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiI2ZmZmZmZiIsInRoZW1lX2NvbG9yIjoiIzAyODRjNyIsImljb25zIjpbeyJzcmMiOiJodHRwczovL3N0b3JhZ2UuZ29vZ2xlYXBpcy5jb20vbWFrZXItbWVkaWEvaW1hZ2VzL3BmLWZpbmFsLWljb24tMTkyLnBuZyIsInNpemVzIjoiMTkyeDE5MiIsInR5cGUiOiJpbWFnZS9wbmciLCJwdXJwb3NlIjoiYW55IG1hc2thYmxlIn0seyJzcmMiOiJodHRwczovL3N0b3JhZ2UuZ29vZ2xlYXBpcy5jb20vbWFrZXItbWVkaWEvaW1hZ2VzL3BmLWZpbmFsLWljb24tNTEyLnBuZyIsInNpemVzIjoiNTEyeDUxMiIsInR5cGUiOiJpbWFnZS9wbmciLCJwdXJwb3NlIjoiYW55IG1hc2thYmxlIn1dfQ==">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .step-card { transition: all 0.3s ease-in-out; }
        .step-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        #loading-overlay, #modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: flex; justify-content: center; align-items: center; z-index: 9999; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; }
        #loading-overlay.visible, #modal-overlay.visible { opacity: 1; visibility: visible; }
        .loader { border: 8px solid #f3f3f3; border-top: 8px solid #3498db; border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- TELA DE AUTENTICAÇÃO -->
    <div id="auth-view" class="min-h-screen flex items-center justify-center hidden">
        <div class="max-w-md w-full bg-white p-8 rounded-lg shadow-lg">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-blue-600">PregaçãoFácil</h1>
                <p id="auth-subtitle" class="text-gray-600 mt-2">Acesse sua conta para continuar</p>
            </div>
            <form id="login-form">
                <div class="mb-4">
                    <label for="login-email" class="block text-gray-700 text-sm font-bold mb-2">Email</label>
                    <input type="email" id="login-email" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                </div>
                <div class="mb-6">
                    <label for="login-password" class="block text-gray-700 text-sm font-bold mb-2">Senha</label>
                    <input type="password" id="login-password" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" required>
                </div>
                <div class="flex items-center justify-between">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Entrar</button>
                    <a id="show-register-link" class="inline-block align-baseline font-bold text-sm text-blue-600 hover:text-blue-800" href="#">Criar conta</a>
                </div>
            </form>
            <form id="register-form" class="hidden">
                <div class="mb-4">
                    <label for="register-email" class="block text-gray-700 text-sm font-bold mb-2">Email</label>
                    <input type="email" id="register-email" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                </div>
                <div class="mb-6">
                    <label for="register-password" class="block text-gray-700 text-sm font-bold mb-2">Senha</label>
                    <input type="password" id="register-password" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" required>
                </div>
                <div class="flex items-center justify-between">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Criar Conta</button>
                    <a id="show-login-link" class="inline-block align-baseline font-bold text-sm text-blue-600 hover:text-blue-800" href="#">Já tenho uma conta</a>
                </div>
            </form>
            <p id="auth-error" class="text-red-500 text-xs italic mt-4 text-center"></p>
        </div>
    </div>

    <!-- TELA DE ASSINATURA -->
    <div id="subscription-view" class="min-h-screen flex items-center justify-center hidden bg-gray-100 py-12">
        <div class="max-w-4xl w-full mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                 <div id="welcome-message" class="hidden mb-6 p-4 bg-green-100 text-green-800 border border-green-200 rounded-lg max-w-2xl mx-auto">
                    <p><strong>Seja bem-vindo(a) ao PregaçãoFácil!</strong> Sua conta foi criada com sucesso.</p>
                </div>
                <h1 class="text-3xl font-bold text-gray-900 sm:text-4xl">Escolha o plano ideal para você</h1>
                <p id="subscription-prompt" class="mt-4 text-xl text-gray-600">Acesse todos os recursos e comece a criar sermões inspiradores hoje mesmo.</p>
            </div>
            
            <div class="mt-10 grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Plano Mensal -->
                <div class="border border-gray-200 rounded-lg shadow-sm divide-y divide-gray-200 bg-white">
                    <div class="p-6 text-center">
                        <h2 class="text-lg leading-6 font-medium text-gray-900">Mensal</h2>
                        <p class="mt-2 text-4xl font-extrabold text-gray-900">R$10<span class="text-base font-medium text-gray-500">/mês</span></p>
                        <p class="mt-4 text-sm text-gray-500">Ideal para experimentar.</p>
                        <a href="https://www.mercadopago.com.br/subscriptions/checkout?preapproval_plan_id=92fdaa305c3e4b269e9df7bed3419436" class="mt-8 block w-full bg-blue-600 border border-transparent rounded-md py-2 text-sm font-semibold text-white text-center hover:bg-blue-700">Assinar Agora</a>
                    </div>
                </div>

                <!-- Plano Anual (Destaque) -->
                <div class="border-2 border-blue-600 rounded-lg shadow-lg divide-y divide-gray-200 bg-white relative">
                    <div class="absolute top-0 right-0 -mt-3 mr-3">
                        <span class="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-blue-100 text-blue-800">Mais Popular</span>
                    </div>
                    <div class="p-6 text-center">
                        <h2 class="text-lg leading-6 font-medium text-blue-600">Anual</h2>
                        <p class="mt-2 text-4xl font-extrabold text-blue-600">R$8<span class="text-base font-medium text-gray-500">/mês</span></p>
                        <p class="mt-4 text-sm text-gray-500">Cobrança de R$96,00 por ano.<br><strong class="text-blue-600">Economize 20%!</strong></p>
                        <a href="https://www.mercadopago.com.br/subscriptions/checkout?preapproval_plan_id=da26eac3c3c5400ca51856d8d65f62bc" class="mt-8 block w-full bg-blue-600 border border-transparent rounded-md py-2 text-sm font-semibold text-white text-center hover:bg-blue-700">Assinar Agora</a>
                    </div>
                </div>

                <!-- Plano Semestral -->
                <div class="border border-gray-200 rounded-lg shadow-sm divide-y divide-gray-200 bg-white">
                    <div class="p-6 text-center">
                        <h2 class="text-lg leading-6 font-medium text-gray-900">Semestral</h2>
                        <p class="mt-2 text-4xl font-extrabold text-gray-900">R$9<span class="text-base font-medium text-gray-500">/mês</span></p>
                        <p class="mt-4 text-sm text-gray-500">Cobrança de R$54,00 a cada 6 meses (10% de desconto).</p>
                        <a href="https://www.mercadopago.com.br/subscriptions/checkout?preapproval_plan_id=93dd9fbf145b4cd49276013df7bb1a37" class="mt-8 block w-full bg-blue-600 border border-transparent rounded-md py-2 text-sm font-semibold text-white text-center hover:bg-blue-700">Assinar Agora</a>
                    </div>
                </div>
            </div>

            <div class="text-center mt-8">
                <button id="logout-btn-sub" class="text-sm text-gray-500 hover:text-gray-700 underline">Sair da conta</button>
            </div>
        </div>
    </div>

    <!-- TELA PRINCIPAL DO APP -->
    <div id="app-view" class="hidden">
        <!-- Overlays do App -->
        <div id="loading-overlay"><div class="loader"></div></div>
        <div id="modal-overlay">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 flex flex-col max-h-[85vh]">
                <div class="p-6 border-b sticky top-0 bg-white rounded-t-lg">
                    <h3 id="modal-title" class="text-2xl font-bold"></h3>
                </div>
                <div id="modal-content" class="p-6 prose max-w-none overflow-y-auto"></div>
                <div class="p-4 border-t text-right sticky bottom-0 bg-white rounded-b-lg flex justify-end gap-4">
                    <button id="copy-modal-btn" class="bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700">Copiar</button>
                    <button id="close-modal-btn" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700">Fechar</button>
                </div>
            </div>
        </div>

        <!-- Conteúdo do App -->
        <div class="container mx-auto p-4 md:p-8 max-w-5xl">
            <header class="text-center mb-12 flex justify-between items-center">
                <div></div> <!-- Espaçador -->
                <div>
                    <h1 class="text-4xl md:text-5xl font-bold text-blue-600">PregaçãoFácil</h1>
                    <p class="text-lg text-gray-600 mt-2">Organize a mensagem. Liberte o pregador.</p>
                </div>
                <button id="logout-btn-app" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg">Sair</button>
            </header>
            <main id="main-content">
                 <!-- Todo o conteúdo do gerador de sermão (Passo 1, 2, 3, etc.) entra aqui -->
                 <div id="step-1" class="step-container">
                    <h2 class="text-2xl font-semibold mb-6 text-center">Passo 1: Qual é o propósito da sua pregação?</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="step-card bg-white p-6 rounded-lg shadow-md cursor-pointer" data-action="select" data-type="purpose" data-value="Ensino (Didática)">
                            <div class="flex items-center justify-center"><span>Ensino</span><div class="group relative ml-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg><div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 bg-gray-800 text-white text-xs rounded py-2 px-3 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">Para edificar e aprofundar o conhecimento bíblico e teológico da congregação.</div></div></div>
                        </div>
                        <div class="step-card bg-white p-6 rounded-lg shadow-md cursor-pointer" data-action="select" data-type="purpose" data-value="Evangelismo (Querigmática)">
                            <div class="flex items-center justify-center"><span>Evangelismo</span><div class="group relative ml-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg><div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 bg-gray-800 text-white text-xs rounded py-2 px-3 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">Para apresentar o plano de salvação de forma clara e convidativa a não-crentes.</div></div></div>
                        </div>
                        <div class="step-card bg-white p-6 rounded-lg shadow-md cursor-pointer" data-action="select" data-type="purpose" data-value="Exortação (Paraclética)">
                            <div class="flex items-center justify-center"><span>Exortação</span><div class="group relative ml-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg><div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 bg-gray-800 text-white text-xs rounded py-2 px-3 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">Para desafiar, motivar e corrigir a congregação à ação e ao arrependimento.</div></div></div>
                        </div>
                        <div class="step-card bg-white p-6 rounded-lg shadow-md cursor-pointer" data-action="select" data-type="purpose" data-value="Consolo (Pastoral)">
                            <div class="flex items-center justify-center"><span>Consolo</span><div class="group relative ml-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg><div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 bg-gray-800 text-white text-xs rounded py-2 px-3 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">Para trazer conforto, esperança e encorajamento para pessoas que enfrentam dificuldades.</div></div></div>
                        </div>
                        <div class="step-card bg-white p-6 rounded-lg shadow-md cursor-pointer col-span-1 sm:col-span-2 lg:col-span-1" data-action="select" data-type="purpose" data-value="Celebração (Ocasional)">
                            <div class="flex items-center justify-center"><span>Celebração</span><div class="group relative ml-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg><div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 bg-gray-800 text-white text-xs rounded py-2 px-3 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">Para marcar datas e eventos especiais do calendário cristão e da vida da igreja.</div></div></div>
                        </div>
                    </div>
                </div>
                <div id="step-1-1" class="step-container hidden"><h2 class="text-2xl font-semibold mb-6 text-center">Qual é a categoria da Celebração?</h2><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div class="step-card bg-white p-6 rounded-lg shadow-md cursor-pointer" data-action="show-celebration-options" data-value="calendario">Calendário Cristão</div><div class="step-card bg-white p-6 rounded-lg shadow-md cursor-pointer" data-action="show-celebration-options" data-value="vidaIgreja">Vida da Igreja</div><div class="step-card bg-white p-6 rounded-lg shadow-md cursor-pointer" data-action="show-celebration-options" data-value="eventosEspeciais">Datas e Eventos Especiais</div></div><div class="text-center mt-6"><button class="back-btn text-sm text-blue-600 hover:underline" data-target="step-1">Voltar</button></div></div>
                <div id="step-1-2" class="step-container hidden"></div>
                <div id="step-2" class="step-container hidden"><h2 class="text-2xl font-semibold mb-6 text-center">Passo 2: Para quem ou para qual área da vida?</h2><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="step-card bg-white p-6 rounded-lg shadow-md cursor-pointer" data-action="show-area-options" data-value="grupos">A. Grupos Específicos (Público-Alvo)</div><div class="step-card bg-white p-6 rounded-lg shadow-md cursor-pointer" data-action="show-area-options" data-value="areas">B. Áreas da Vida (Contexto)</div></div><div class="text-center mt-6"><button id="back-from-step2" class="text-sm text-blue-600 hover:underline">Voltar</button></div></div>
                <div id="step-2-1" class="step-container hidden"></div>
                <div id="step-3" class="step-container hidden"><h2 class="text-2xl font-semibold mb-6 text-center">Passo 3: Qual é a categoria do tema?</h2><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div class="step-card bg-white p-6 rounded-lg shadow-md cursor-pointer" data-action="show-theme-options" data-value="teologicos">A. Temas Teológicos</div><div class="step-card bg-white p-6 rounded-lg shadow-md cursor-pointer" data-action="show-theme-options" data-value="praticos">B. Temas da Vida Cristã</div><div class="step-card bg-white p-6 rounded-lg shadow-md cursor-pointer" data-action="show-theme-options" data-value="desafios">C. Desafios e Superação</div></div><div class="text-center mt-6"><button class="back-btn text-sm text-blue-600 hover:underline" data-target="step-2-1">Voltar</button></div></div>
                <div id="step-3-1" class="step-container hidden"></div>
                <div id="step-3-2" class="step-container hidden"></div>
                <div id="main-error-message" class="hidden my-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg text-center"><p><strong>Ocorreu um erro:</strong> <span id="main-error-text"></span></p></div>
                <div id="generate-button-container" class="step-container text-center mt-8 hidden"><button id="generate-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition-colors duration-300">Gerar Esboço</button><div class="text-center mt-4"><button class="back-btn text-sm text-blue-600 hover:underline" data-target="step-3-2">Voltar</button></div></div>
            </main>
            <div id="results-container" class="hidden mt-12 bg-white p-6 md:p-8 rounded-lg shadow-lg">
                <h2 class="text-3xl font-bold mb-6 border-b pb-4">Seu Esboço de Pregação</h2>
                <div id="results-content" class="prose max-w-none"></div>
                <div class="mt-8 border-t pt-6 flex flex-col md:flex-row gap-4"><button id="deepen-btn" class="bg-purple-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-purple-700 transition-colors duration-300 w-full group relative"><div class="flex items-center justify-center"><span id="deepen-btn-text">✨ Aprofundar Tema</span><div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-72 bg-gray-800 text-white text-xs rounded py-2 px-3 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">Gera uma análise teológica detalhada do tema e do texto base, explorando contexto histórico e significados originais.</div></div></button><button id="illustrate-btn" class="bg-teal-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-teal-600 transition-colors duration-300 w-full group relative"><div class="flex items-center justify-center"><span id="illustrate-btn-text">✨ Criar Ilustração</span><div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-72 bg-gray-800 text-white text-xs rounded py-2 px-3 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">Cria uma nova história ou analogia para conectar a mensagem ao coração dos ouvintes.</div></div></button></div>
                <div class="mt-8 border-t pt-6 flex flex-col md:flex-row gap-4"><button id="copy-esboco-btn" class="bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition-colors duration-300 w-full">Copiar Esboço</button><button id="reset-btn" class="bg-gray-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-600 transition-colors duration-300 w-full">Criar Novo Esboço</button></div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script type="module">
        // Importações do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, setPersistence, browserSessionPersistence, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Todo o código do aplicativo
        document.addEventListener('DOMContentLoaded', async () => {
            const firebaseConfig = {
                apiKey: "AIzaSyD5RiD_NitvmIY5G1X6XBayJBmNnBraWgQ",
                authDomain: "pregacaofacil-app.firebaseapp.com",
                projectId: "pregacaofacil-app",
                storageBucket: "pregacaofacil-app.appspot.com",
                messagingSenderId: "558411431322",
                appId: "1:558411431322:web:3d8e2338bb3537345f4e23"
            };
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            
            // Define a persistência da autenticação para a sessão atual
            await setPersistence(auth, browserSessionPersistence);

            // Lógica de Autenticação
            const authView = document.getElementById('auth-view');
            const appView = document.getElementById('app-view');
            const subscriptionView = document.getElementById('subscription-view');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const showRegisterLink = document.getElementById('show-register-link');
            const showLoginLink = document.getElementById('show-login-link');
            const authSubtitle = document.getElementById('auth-subtitle');
            const authError = document.getElementById('auth-error');
            const logoutBtnApp = document.getElementById('logout-btn-app');
            const logoutBtnSub = document.getElementById('logout-btn-sub');
            const welcomeMessage = document.getElementById('welcome-message');
            const subscriptionPrompt = document.getElementById('subscription-prompt');
            
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    const userDocRef = doc(db, "users", user.uid);
                    const userDocSnap = await getDoc(userDocRef);
                    const creationTime = new Date(user.metadata.creationTime);
                    const lastSignInTime = new Date(user.metadata.lastSignInTime);
                    const isNewUser = (lastSignInTime.getTime() - creationTime.getTime()) < 2000;

                    if (userDocSnap.exists() && userDocSnap.data().subscriptionActive === true) {
                        authView.classList.add('hidden');
                        subscriptionView.classList.add('hidden');
                        appView.classList.remove('hidden');
                    } else {
                        authView.classList.add('hidden');
                        appView.classList.add('hidden');
                        subscriptionView.classList.remove('hidden');
                        if (isNewUser) {
                            welcomeMessage.classList.remove('hidden');
                            subscriptionPrompt.textContent = 'Para começar a usar a ferramenta, o próximo passo é escolher um dos nossos planos de assinatura.';
                        } else {
                            welcomeMessage.classList.add('hidden');
                            subscriptionPrompt.textContent = 'Para utilizar o PregaçãoFácil, é necessário ter uma assinatura ativa. Escolha um dos nossos planos e libere todo o potencial da ferramenta!';
                        }
                    }
                } else {
                    appView.classList.add('hidden');
                    subscriptionView.classList.add('hidden');
                    authView.classList.remove('hidden');
                }
            });
            registerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                authError.textContent = '';
                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;
                    await setDoc(doc(db, "users", user.uid), {
                        email: user.email,
                        createdAt: new Date(),
                        subscriptionActive: false
                    });
                } catch (error) {
                     if (error.code === 'auth/email-already-in-use') {
                        authError.textContent = "Este e-mail já está cadastrado. Tente fazer login.";
                    } else {
                        authError.textContent = "Erro ao criar conta: " + error.message;
                    }
                }
            });
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                authError.textContent = '';
                try {
                    await signInWithEmailAndPassword(auth, email, password);
                } catch (error) {
                    authError.textContent = "Erro ao entrar: " + error.message;
                }
            });
            const handleLogout = async () => {
                try { await signOut(auth); } catch (error) { console.error("Erro ao sair:", error); }
            };
            logoutBtnApp.addEventListener('click', handleLogout);
            logoutBtnSub.addEventListener('click', handleLogout);
            showRegisterLink.addEventListener('click', (e) => { e.preventDefault(); loginForm.classList.add('hidden'); registerForm.classList.remove('hidden'); authSubtitle.textContent = 'Crie sua conta para começar'; authError.textContent = ''; });
            showLoginLink.addEventListener('click', (e) => { e.preventDefault(); registerForm.classList.add('hidden'); loginForm.classList.remove('hidden'); authSubtitle.textContent = 'Acesse sua conta para continuar'; authError.textContent = ''; });

            // A lógica do app principal (gerador de sermões) continua aqui...
        });
    </script>
    
    <!-- Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register(
                URL.createObjectURL(new Blob([`
                    self.addEventListener('fetch', () => {});
                `], { type: 'application/javascript' }))
            ).then(function(registration) {
                // console.log('Service Worker registrado com sucesso:', registration);
            }).catch(function(error) {
                console.log('Falha ao registrar Service Worker:', error);
            });
        }
    </script>
</body>
</html>

